# μ λ© μ΄μ»¤λ¨Έμ¤ μ‹μ¤ν…

-----------------------------------------------------------------


# π”„ Kafka Data Flow in E-commerce System



-----------------------------------------------------------------



---
## π“¦ κ°μ”
> μ‚¬μ©μκ°€ μƒν’μ„ μ£Όλ¬Έν•λ©΄, ν•΄λ‹Ή μ£Όλ¬Έ μ™„λ£ μ΄λ²¤νΈ(`OrderCompletedEvent`)κ°€ λ°ν–‰λμ–΄  
> ν¬μΈνΈ μ λ¦½, μΏ ν° μ‚¬μ© μ²λ¦¬, μ΄λ©”μΌ λ°μ†΅ λ“± ν›„μ† μ²λ¦¬κ°€ λ³‘λ ¬λ΅ μν–‰λ©λ‹λ‹¤.



---



## π§© λ°μ΄ν„° νλ¦„ κµ¬μ΅° (μ”μ•½)

| λ‹¨κ³„ | μ£Όμ²΄ | μ„¤λ… |
|------|------|------|
| 1 | μ‚¬μ©μ | μ£Όλ¬Έ μ”μ²­ API νΈμ¶ |
| 2 | OrderController | μ£Όλ¬Έ μ”μ²­ μμ‹ , OrderService νΈμ¶ |
| 3 | OrderService | μ£Όλ¬Έ μƒμ„± λ° DB μ €μ¥ ν›„ `OrderCompletedEvent` λ°ν–‰ |
| 4 | KafkaProducer | μ΄λ²¤νΈλ¥Ό `order.completed` TopicμΌλ΅ μ „μ†΅ |
| 5 | Kafka Broker | λ©”μ‹μ§€λ¥Ό Topicμ— μ €μ¥, Consumerμ— μ „λ‹¬ λ€κΈ° |
| 6 | PointConsumer | λ©”μ‹μ§€ μμ‹  ν›„ ν¬μΈνΈ μ λ¦½ |
| 7 | CouponConsumer | λ©”μ‹μ§€ μμ‹  ν›„ μΏ ν° μ‚¬μ© μ²λ¦¬ |
| 8 | EmailConsumer | λ©”μ‹μ§€ μμ‹  ν›„ μ΄λ©”μΌ λ°μ†΅ |



---




## π§© PlanText

```plaintext
[User]
  β”‚
  β–Ό
[OrderController.createOrder()]
  β”‚
  β–Ό
[OrderService.createOrder()]
  β”‚
  β”β”€β”€> Save Order in DB
  β””β”€β”€> KafkaProducer.send("order.completed", OrderCompletedEvent)
        β”‚
        β–Ό
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€ Kafka Broker β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚                                      β”‚
    β–Ό                                      β–Ό
[PointConsumer]                     [CouponConsumer]
    β”‚                                      β”‚
    β–Ό                                      β–Ό
ν¬μΈνΈ μ λ¦½                           μΏ ν° μ‚¬μ© μ²λ¦¬

    β–Ό
[EmailConsumer]
    β”‚
    β–Ό
μ΄λ©”μΌ λ°μ†΅
 ```



---




## β™οΈ Kafka Topic κµ¬μ΅° μμ‹
| Topic μ΄λ¦„          | μ„¤λ…            |
| ----------------- | ------------- |
| `order.completed` | μ£Όλ¬Έ μ™„λ£ μ΄λ²¤νΈ λ°ν–‰μ© |
| `coupon.used`     | μΏ ν° μ‚¬μ© μ™„λ£ μ•λ¦Ό   |
| `point.earned`    | ν¬μΈνΈ μ λ¦½ μ™„λ£ μ•λ¦Ό  |
---




## π”„ λ©”μ‹μ§€ μ†λΉ„ λ°©μ‹
* PointConsumer
  * λ©”μ‹μ§€λ¥Ό μμ‹ ν•μ—¬ ν•΄λ‹Ή μ μ €μ ν¬μΈνΈ κ³„μ •μ— μ λ¦½ κΈ°λ΅ μ¶”κ°€
* CouponConsumer
  * μΏ ν° μ‚¬μ© μ²λ¦¬ λ° μƒνƒ μ—…λ°μ΄νΈ
* EmailConsumer
  * μ£Όλ¬Έ ν™•μΈ λ©”μΌ λ°μ†΅ (μ΄λ©”μΌ ν…ν”λ¦Ώ μ‹μ¤ν… μ—°κ³„)