<!--
  이커머스 시스템 설계 
-->
# 제목 이커머스 시스템
<!--
  (Optional: 참고 자료가 없는 작업 - 단순 버그 픽스 등 의 경우엔 해당 란을 제거해주세요 !)
  작업에 대한 참고자료(PR, 피그마, 슬랙 등)가 있는 경우 링크를 참고 자료에 같이 추가해주세요.
  히스토리나 정책, 특정 기술 등에 대한 이해가 필요한 작업일 때 참고자료가 있다면 리뷰어에게 큰 도움이 됩니다!
-->
-----------------------------------------------------------------
## PR
### 9주차

## ☔︎ 현재 커밋 링크 
* Redis 실시간 기반 인기 상품 조회 클래스 작성 : [10150c8](https://github.com/JuSuIn/hhplusweek2/commit/10150c820f6fdbcab68e4a0a2f2bd1e0ea16bbe6)
* 2) Kafka 관련 시나리오 작성(현재 md 파일에 간략하게 작성) : [03320ca](https://github.com/JuSuIn/hhplusweek2/commit/03320ca716942db24cb77355adce766e7698c617)

  

-----------------------------------------------------------------
## 현재 완료 된 부분

---------------------------------------------------------
# 2) Kafka 관련 시나리오 작성
## ✅ Kafka 사용 시나리오 확정 (이커머스 주문 생성 기준)

###  🎯 핵심 목표
* 주문 생성 후 후처리 작업(포인트 적립, 쿠폰 사용, 이메일 발송)을 Kafka 기반의 비동기 이벤트 처리로 구성한다.


### 📌 시나리오 명: 주문 완료 이벤트 발행 (OrderCompletedEvent)
| 구분           | 설명                                                                        |
| ------------ | ------------------------------------------------------------------------- |
| 📍 트리거       | 사용자가 상품을 주문하면 `OrderService.createOrder()`가 실행됨                           |
| 📤 Producer  | `OrderService`에서 `OrderCompletedEvent`를 Kafka 토픽에 발행                      |
| 📬 Consumers | `PointConsumer`, `CouponConsumer`, `EmailConsumer`는 각각 이 이벤트를 수신하고 후처리 수행 |


### 🧩 Kafka 주문 완료 처리 흐름
| 단계 | 구성 요소                           | 설명                                      |
| -- | ------------------------------- | --------------------------------------- |
| ①  | 사용자                             | 프론트엔드에서 주문 요청을 보냄                       |
| ②  | `OrderController.createOrder()` | 주문 요청을 받아 `OrderService` 호출             |
| ③  | `OrderService.createOrder()`    | 주문 생성, DB 저장 후 `OrderCompletedEvent` 발행 |
| ④  | `KafkaProducer.send(...)`       | `order.completed` 토픽에 이벤트 발행            |
| ⑤  | `Kafka Broker`                  | 이벤트를 브로커를 통해 전파                         |
| ⑥  | `PointConsumer`                 | 포인트 적립 수행                               |
| ⑦  | `CouponConsumer`                | 쿠폰 사용 처리 (예: 사용 여부 업데이트)                |
| ⑧  | `EmailConsumer`                 | 이메일 발송 트리거 (주문 확인 이메일 등)                |



### ✅ Kafka 사용 이유
| 이유       | 설명                                 |
| -------- | ---------------------------------- |
| 비동기 처리   | 주문과 후처리를 분리하여 서비스 간 결합도를 낮춤        |
| 확장성      | 소비자를 독립적으로 추가할 수 있어 마이크로서비스 확장에 유리 |
| 장애 격리    | 소비자가 실패해도 주문 처리는 영향을 받지 않음         |
| 분산 환경 대비 | MSA 구조에서 이벤트 드리븐 설계에 필수적           |



### 🎯 확정 시나리오 정리
| 항목     | 내용                                                 |
| ------ | -------------------------------------------------- |
| 이벤트 이름 | `OrderCompletedEvent`                              |
| 발행 위치  | `OrderService.createOrder()` 내부                    |
| 발행 방식  | `KafkaTemplate.send("order.completed", event)`     |
| 소비자들   | `PointConsumer`, `CouponConsumer`, `EmailConsumer` |
| 후처리 작업 | 포인트 적립, 쿠폰 처리, 이메일 발송                              |


---------------------------------------------------------